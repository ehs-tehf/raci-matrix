<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>RACI Matrix â€” Project Manager</title>
  <link href="https://fonts.googleapis.com/css2?family=DM+Mono:wght@400;500&family=Syne:wght@400;600;700;800&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet"/>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg: #0d0f14;
      --surface: #161922;
      --surface2: #1e2230;
      --border: #2a2f42;
      --border2: #353c55;
      --text: #e8eaf2;
      --text-muted: #6b738f;
      --text-dim: #4a5068;
      --accent: #5b7fff;
      --accent2: #7c5cfc;
      --R: #ff5e7d;
      --A: #ffb547;
      --C: #38d9a9;
      --I: #5b7fff;
      --R-bg: rgba(255,94,125,0.12);
      --A-bg: rgba(255,181,71,0.12);
      --C-bg: rgba(56,217,169,0.12);
      --I-bg: rgba(91,127,255,0.12);
      --none-bg: rgba(255,255,255,0.03);
    }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: 'DM Sans', sans-serif;
      min-height: 100vh;
      overflow-x: auto;
    }

    /* HEADER */
    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 20px 32px;
      border-bottom: 1px solid var(--border);
      background: var(--surface);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .logo-mark {
      width: 36px;
      height: 36px;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: 'DM Mono', monospace;
      font-weight: 500;
      font-size: 13px;
      color: #fff;
      letter-spacing: -1px;
    }

    .logo-text {
      font-family: 'Syne', sans-serif;
      font-weight: 700;
      font-size: 18px;
      letter-spacing: -0.3px;
    }

    .logo-text span {
      color: var(--text-muted);
      font-weight: 400;
    }

    .header-actions {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .btn {
      padding: 8px 16px;
      border-radius: 8px;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      border: none;
      transition: all 0.15s ease;
      font-family: 'DM Sans', sans-serif;
    }

    .btn-ghost {
      background: transparent;
      color: var(--text-muted);
      border: 1px solid var(--border);
    }
    .btn-ghost:hover { background: var(--surface2); color: var(--text); border-color: var(--border2); }

    .btn-primary {
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      color: #fff;
    }
    .btn-primary:hover { opacity: 0.88; transform: translateY(-1px); }

    .btn-danger {
      background: transparent;
      color: #ff6b6b;
      border: 1px solid rgba(255,107,107,0.3);
    }
    .btn-danger:hover { background: rgba(255,107,107,0.1); }

    /* MAIN */
    main {
      padding: 32px;
      max-width: 1400px;
      margin: 0 auto;
    }

    /* PROJECT INFO */
    .project-bar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 28px;
      gap: 16px;
    }

    .project-name-wrap {
      display: flex;
      align-items: center;
      gap: 10px;
      flex: 1;
    }

    .project-name-input {
      font-family: 'Syne', sans-serif;
      font-size: 22px;
      font-weight: 800;
      background: transparent;
      border: none;
      color: var(--text);
      outline: none;
      border-bottom: 2px solid transparent;
      padding-bottom: 2px;
      transition: border-color 0.2s;
      flex: 1;
    }
    .project-name-input:focus { border-color: var(--accent); }
    .project-name-input::placeholder { color: var(--text-dim); }

    /* LEGEND */
    .legend {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-bottom: 24px;
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 7px;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 6px 12px;
      font-size: 12px;
    }

    .legend-badge {
      width: 22px;
      height: 22px;
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: 'DM Mono', monospace;
      font-size: 11px;
      font-weight: 500;
    }

    .legend-item.R .legend-badge { background: var(--R-bg); color: var(--R); }
    .legend-item.A .legend-badge { background: var(--A-bg); color: var(--A); }
    .legend-item.C .legend-badge { background: var(--C-bg); color: var(--C); }
    .legend-item.I .legend-badge { background: var(--I-bg); color: var(--I); }

    .legend-label { color: var(--text-muted); }
    .legend-label strong { color: var(--text); font-weight: 500; }

    /* TABLE CONTAINER */
    .table-wrap {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 14px;
      overflow: auto;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      min-width: 600px;
    }

    thead th {
      padding: 0;
      background: var(--surface2);
      border-bottom: 1px solid var(--border);
      position: sticky;
      top: 0;
      z-index: 10;
    }

    /* Task column header */
    thead th.th-task {
      min-width: 220px;
      text-align: left;
      padding: 14px 20px;
      font-family: 'DM Mono', monospace;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: var(--text-muted);
    }

    /* Role column header */
    .th-role-inner {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      padding: 12px 10px 10px;
      min-width: 100px;
      position: relative;
    }

    .th-role-name {
      font-size: 13px;
      font-weight: 500;
      color: var(--text);
      text-align: center;
      word-break: break-word;
      cursor: pointer;
      padding: 3px 6px;
      border-radius: 5px;
      border: 1px solid transparent;
      transition: all 0.15s;
      width: 100%;
      background: transparent;
      font-family: 'DM Sans', sans-serif;
      outline: none;
    }
    .th-role-name:focus { border-color: var(--accent); background: var(--surface); }

    .th-role-sub {
      font-family: 'DM Mono', monospace;
      font-size: 10px;
      color: var(--text-dim);
      letter-spacing: 0.5px;
    }

    .th-role-del {
      position: absolute;
      top: 6px;
      right: 6px;
      width: 18px;
      height: 18px;
      border-radius: 5px;
      border: none;
      background: transparent;
      color: var(--text-dim);
      cursor: pointer;
      font-size: 12px;
      display: none;
      align-items: center;
      justify-content: center;
      transition: all 0.15s;
    }
    thead th:hover .th-role-del { display: flex; }
    .th-role-del:hover { background: rgba(255,107,107,0.2); color: #ff6b6b; }

    /* ROWS */
    tbody tr {
      border-bottom: 1px solid var(--border);
      transition: background 0.12s;
    }
    tbody tr:last-child { border-bottom: none; }
    tbody tr:hover { background: rgba(255,255,255,0.02); }

    /* Task cell */
    td.td-task {
      padding: 10px 20px;
      vertical-align: middle;
    }

    .task-row-inner {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .task-number {
      font-family: 'DM Mono', monospace;
      font-size: 11px;
      color: var(--text-dim);
      min-width: 22px;
    }

    .task-name-input {
      background: transparent;
      border: 1px solid transparent;
      color: var(--text);
      font-size: 14px;
      font-family: 'DM Sans', sans-serif;
      padding: 5px 8px;
      border-radius: 6px;
      outline: none;
      flex: 1;
      transition: border-color 0.15s;
    }
    .task-name-input:focus { border-color: var(--accent); background: var(--surface2); }
    .task-name-input::placeholder { color: var(--text-dim); }

    .task-del-btn {
      width: 26px;
      height: 26px;
      border-radius: 6px;
      border: none;
      background: transparent;
      color: var(--text-dim);
      cursor: pointer;
      font-size: 14px;
      display: none;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      transition: all 0.15s;
    }
    tr:hover .task-del-btn { display: flex; }
    .task-del-btn:hover { background: rgba(255,107,107,0.15); color: #ff6b6b; }

    /* RACI cell */
    td.td-raci {
      text-align: center;
      vertical-align: middle;
      padding: 8px 6px;
    }

    .raci-cycle {
      width: 44px;
      height: 44px;
      border-radius: 10px;
      margin: 0 auto;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: 'DM Mono', monospace;
      font-size: 15px;
      font-weight: 500;
      transition: all 0.15s ease;
      border: 2px solid transparent;
      user-select: none;
      position: relative;
    }

    .raci-cycle[data-val=""] {
      background: var(--none-bg);
      color: var(--text-dim);
      border-color: transparent;
    }
    .raci-cycle[data-val=""]:hover { background: var(--surface2); border-color: var(--border2); color: var(--text-muted); }
    .raci-cycle[data-val=""]::after { content: 'â€”'; font-size: 13px; }

    .raci-cycle[data-val="R"] { background: var(--R-bg); color: var(--R); border-color: rgba(255,94,125,0.3); }
    .raci-cycle[data-val="R"]:hover { filter: brightness(1.15); }

    .raci-cycle[data-val="A"] { background: var(--A-bg); color: var(--A); border-color: rgba(255,181,71,0.3); }
    .raci-cycle[data-val="A"]:hover { filter: brightness(1.15); }

    .raci-cycle[data-val="C"] { background: var(--C-bg); color: var(--C); border-color: rgba(56,217,169,0.3); }
    .raci-cycle[data-val="C"]:hover { filter: brightness(1.15); }

    .raci-cycle[data-val="I"] { background: var(--I-bg); color: var(--I); border-color: rgba(91,127,255,0.3); }
    .raci-cycle[data-val="I"]:hover { filter: brightness(1.15); }

    .raci-cycle:active { transform: scale(0.9); }

    /* ADD ROW / COL */
    .add-row-tr td {
      padding: 8px 20px;
    }

    .add-btn-inline {
      background: transparent;
      border: 1px dashed var(--border2);
      color: var(--text-muted);
      border-radius: 8px;
      padding: 7px 14px;
      font-size: 13px;
      cursor: pointer;
      font-family: 'DM Sans', sans-serif;
      transition: all 0.15s;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .add-btn-inline:hover { border-color: var(--accent); color: var(--accent); background: var(--I-bg); }

    /* ADD ROLE */
    .th-add-role {
      padding: 0 !important;
      vertical-align: middle;
    }
    .add-role-btn {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      padding: 12px 16px;
      background: transparent;
      border: none;
      cursor: pointer;
      color: var(--text-muted);
      font-size: 12px;
      font-family: 'DM Sans', sans-serif;
      transition: all 0.15s;
      white-space: nowrap;
    }
    .add-role-btn:hover { color: var(--accent); }
    .add-role-icon { font-size: 20px; line-height: 1; }

    /* STATS */
    .stats-bar {
      display: flex;
      gap: 12px;
      margin-top: 24px;
      flex-wrap: wrap;
    }

    .stat-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 12px 18px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .stat-dot {
      width: 10px;
      height: 10px;
      border-radius: 3px;
    }

    .stat-label { font-size: 12px; color: var(--text-muted); }
    .stat-count { font-family: 'DM Mono', monospace; font-size: 20px; font-weight: 500; color: var(--text); }

    /* TOAST */
    .toast {
      position: fixed;
      bottom: 28px;
      right: 28px;
      background: var(--surface2);
      border: 1px solid var(--border2);
      border-radius: 10px;
      padding: 12px 20px;
      font-size: 13px;
      color: var(--text);
      display: flex;
      align-items: center;
      gap: 10px;
      opacity: 0;
      transform: translateY(10px);
      transition: all 0.25s ease;
      pointer-events: none;
      z-index: 999;
    }
    .toast.show { opacity: 1; transform: translateY(0); }
    .toast-icon { font-size: 16px; }

    /* MODAL */
    .modal-overlay {
      position: fixed; inset: 0;
      background: rgba(0,0,0,0.6);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 200;
      backdrop-filter: blur(4px);
    }
    .modal-overlay.open { display: flex; }

    .modal {
      background: var(--surface);
      border: 1px solid var(--border2);
      border-radius: 16px;
      padding: 28px;
      width: 420px;
      max-width: 95vw;
    }

    .modal h2 {
      font-family: 'Syne', sans-serif;
      font-size: 18px;
      font-weight: 700;
      margin-bottom: 6px;
    }

    .modal p { font-size: 13px; color: var(--text-muted); margin-bottom: 20px; }

    .modal-input {
      width: 100%;
      background: var(--bg);
      border: 1px solid var(--border2);
      border-radius: 8px;
      padding: 10px 14px;
      color: var(--text);
      font-size: 14px;
      font-family: 'DM Sans', sans-serif;
      outline: none;
      transition: border-color 0.15s;
      margin-bottom: 16px;
    }
    .modal-input:focus { border-color: var(--accent); }

    .modal-actions { display: flex; gap: 10px; justify-content: flex-end; }

    /* Scrollbar */
    ::-webkit-scrollbar { width: 6px; height: 6px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: var(--border2); border-radius: 3px; }

    @keyframes pop {
      0% { transform: scale(1); }
      50% { transform: scale(1.25); }
      100% { transform: scale(1); }
    }
    .popped { animation: pop 0.2s ease; }
  </style>
</head>
<body>

<!-- HEADER -->
<header>
  <div class="logo">
    <div class="logo-mark">RA<br>CI</div>
    <div class="logo-text">RACI <span>Matrix</span></div>
  </div>
  <div class="header-actions">
    <button class="btn btn-ghost" onclick="clearAll()">ðŸ—‘ Clear All</button>
    <button class="btn btn-ghost" onclick="saveData()">ðŸ’¾ Save</button>
    <button class="btn btn-primary" onclick="openNewProject()">ï¼‹ New Project</button>
  </div>
</header>

<main>
  <!-- PROJECT NAME -->
  <div class="project-bar">
    <div class="project-name-wrap">
      <input id="project-name" class="project-name-input" placeholder="Untitled Project" value="Website Redesign 2024" />
    </div>
  </div>

  <!-- LEGEND -->
  <div class="legend">
    <div class="legend-item R"><div class="legend-badge">R</div><div class="legend-label"><strong>Responsible</strong> â€” does the work</div></div>
    <div class="legend-item A"><div class="legend-badge">A</div><div class="legend-label"><strong>Accountable</strong> â€” signs off</div></div>
    <div class="legend-item C"><div class="legend-badge">C</div><div class="legend-label"><strong>Consulted</strong> â€” gives input</div></div>
    <div class="legend-item I"><div class="legend-badge">I</div><div class="legend-label"><strong>Informed</strong> â€” kept in the loop</div></div>
  </div>

  <!-- TABLE -->
  <div class="table-wrap">
    <table id="raci-table">
      <thead id="table-head"></thead>
      <tbody id="table-body"></tbody>
    </table>
  </div>

  <!-- STATS -->
  <div class="stats-bar" id="stats-bar"></div>
</main>

<!-- TOAST -->
<div class="toast" id="toast">
  <span class="toast-icon">âœ…</span>
  <span id="toast-msg">Saved!</span>
</div>

<!-- MODAL: new role -->
<div class="modal-overlay" id="role-modal">
  <div class="modal">
    <h2>Add Role</h2>
    <p>Enter the name of the new team role or member.</p>
    <input id="role-input" class="modal-input" placeholder="e.g. Product Manager" maxlength="40"/>
    <div class="modal-actions">
      <button class="btn btn-ghost" onclick="closeModal('role-modal')">Cancel</button>
      <button class="btn btn-primary" onclick="confirmAddRole()">Add Role</button>
    </div>
  </div>
</div>

<!-- MODAL: new project -->
<div class="modal-overlay" id="project-modal">
  <div class="modal">
    <h2>New Project</h2>
    <p>This will clear the current board. Enter the name of your new project.</p>
    <input id="project-input" class="modal-input" placeholder="e.g. Mobile App Launch" maxlength="60"/>
    <div class="modal-actions">
      <button class="btn btn-ghost" onclick="closeModal('project-modal')">Cancel</button>
      <button class="btn btn-danger" onclick="confirmNewProject()">Create & Clear</button>
    </div>
  </div>
</div>

<script>
  const CYCLE = ['', 'R', 'A', 'C', 'I'];
  const STORAGE_KEY = 'raci_data_v2';

  let state = {
    project: 'Website Redesign 2024',
    roles: ['Project Manager', 'Designer', 'Developer', 'Stakeholder'],
    tasks: [
      { id: 1, name: 'Define project scope', cells: ['A', 'C', 'R', 'I'] },
      { id: 2, name: 'Wireframe creation', cells: ['C', 'R', 'I', 'I'] },
      { id: 3, name: 'Backend development', cells: ['I', '', 'R', ''] },
      { id: 4, name: 'UI implementation', cells: ['I', 'A', 'R', ''] },
      { id: 5, name: 'User testing', cells: ['A', 'R', 'C', 'I'] },
    ],
    nextId: 6
  };

  function loadState() {
    try {
      const saved = localStorage.getItem(STORAGE_KEY);
      if (saved) {
        state = JSON.parse(saved);
        document.getElementById('project-name').value = state.project || '';
      }
    } catch(e) {}
  }

  function saveData() {
    state.project = document.getElementById('project-name').value;
    try {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
      toast('Project saved âœ“');
    } catch(e) {
      toast('Could not save');
    }
  }

  function render() {
    renderHead();
    renderBody();
    renderStats();
  }

  function renderHead() {
    const head = document.getElementById('table-head');
    let html = '<tr>';
    html += `<th class="th-task">Task / Activity</th>`;
    state.roles.forEach((role, ri) => {
      html += `<th>
        <div class="th-role-inner">
          <input class="th-role-name" value="${escHtml(role)}" onchange="renameRole(${ri}, this.value)" title="Click to rename"/>
          <span class="th-role-sub">role ${ri+1}</span>
          <button class="th-role-del" onclick="deleteRole(${ri})" title="Remove role">âœ•</button>
        </div>
      </th>`;
    });
    html += `<th class="th-add-role">
      <button class="add-role-btn" onclick="openAddRole()">
        <span class="add-role-icon">ï¼‹</span>
        <span>Role</span>
      </button>
    </th>`;
    html += '</tr>';
    head.innerHTML = html;
  }

  function renderBody() {
    const body = document.getElementById('table-body');
    let html = '';
    state.tasks.forEach((task, ti) => {
      html += `<tr>
        <td class="td-task">
          <div class="task-row-inner">
            <span class="task-number">${String(ti+1).padStart(2,'0')}</span>
            <input class="task-name-input" value="${escHtml(task.name)}" 
                   onchange="renameTask(${ti}, this.value)"
                   placeholder="Task nameâ€¦"/>
            <button class="task-del-btn" onclick="deleteTask(${ti})" title="Delete task">âœ•</button>
          </div>
        </td>`;
      state.roles.forEach((_, ri) => {
        const val = task.cells[ri] || '';
        html += `<td class="td-raci">
          <div class="raci-cycle" data-val="${val}" 
               onclick="cycleCell(${ti}, ${ri}, this)"
               title="Click to cycle: â€” â†’ R â†’ A â†’ C â†’ I">${val}</div>
        </td>`;
      });
      html += `<td></td></tr>`;
    });
    // Add task row
    html += `<tr class="add-row-tr">
      <td colspan="${state.roles.length + 2}">
        <button class="add-btn-inline" onclick="addTask()">
          ï¼‹ Add task or activity
        </button>
      </td>
    </tr>`;
    body.innerHTML = html;
  }

  function renderStats() {
    const bar = document.getElementById('stats-bar');
    const counts = { R: 0, A: 0, C: 0, I: 0 };
    state.tasks.forEach(t => t.cells.forEach(c => { if (counts[c] !== undefined) counts[c]++; }));
    const colors = { R: 'var(--R)', A: 'var(--A)', C: 'var(--C)', I: 'var(--I)' };
    const labels = { R: 'Responsible', A: 'Accountable', C: 'Consulted', I: 'Informed' };
    bar.innerHTML = Object.entries(counts).map(([k, v]) => `
      <div class="stat-card">
        <div class="stat-dot" style="background:${colors[k]}"></div>
        <div>
          <div class="stat-count">${v}</div>
          <div class="stat-label">${labels[k]}</div>
        </div>
      </div>
    `).join('') + `
      <div class="stat-card">
        <div class="stat-dot" style="background:var(--text-muted)"></div>
        <div>
          <div class="stat-count">${state.tasks.length}</div>
          <div class="stat-label">Tasks</div>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-dot" style="background:var(--accent2)"></div>
        <div>
          <div class="stat-count">${state.roles.length}</div>
          <div class="stat-label">Roles</div>
        </div>
      </div>
    `;
  }

  function cycleCell(ti, ri, el) {
    const cur = state.tasks[ti].cells[ri] || '';
    const idx = CYCLE.indexOf(cur);
    const next = CYCLE[(idx + 1) % CYCLE.length];
    state.tasks[ti].cells[ri] = next;
    el.setAttribute('data-val', next);
    el.textContent = next;
    el.classList.remove('popped');
    void el.offsetWidth;
    el.classList.add('popped');
    renderStats();
    autoSave();
  }

  function addTask() {
    state.tasks.push({ id: state.nextId++, name: '', cells: new Array(state.roles.length).fill('') });
    render();
    // Focus new input
    const inputs = document.querySelectorAll('.task-name-input');
    if (inputs.length) inputs[inputs.length - 1].focus();
  }

  function deleteTask(ti) {
    state.tasks.splice(ti, 1);
    render();
    autoSave();
  }

  function renameTask(ti, val) {
    state.tasks[ti].name = val;
    autoSave();
  }

  function renameRole(ri, val) {
    state.roles[ri] = val;
    autoSave();
  }

  function deleteRole(ri) {
    if (state.roles.length <= 1) { toast('Need at least 1 role'); return; }
    state.roles.splice(ri, 1);
    state.tasks.forEach(t => t.cells.splice(ri, 1));
    render();
    autoSave();
  }

  function openAddRole() {
    document.getElementById('role-input').value = '';
    openModal('role-modal');
    setTimeout(() => document.getElementById('role-input').focus(), 100);
  }

  function confirmAddRole() {
    const val = document.getElementById('role-input').value.trim();
    if (!val) return;
    state.roles.push(val);
    state.tasks.forEach(t => t.cells.push(''));
    closeModal('role-modal');
    render();
    autoSave();
  }

  function openNewProject() {
    document.getElementById('project-input').value = '';
    openModal('project-modal');
    setTimeout(() => document.getElementById('project-input').focus(), 100);
  }

  function confirmNewProject() {
    const val = document.getElementById('project-input').value.trim();
    state = {
      project: val || 'Untitled Project',
      roles: ['Role 1', 'Role 2', 'Role 3'],
      tasks: [{ id: 1, name: '', cells: ['', '', ''] }],
      nextId: 2
    };
    document.getElementById('project-name').value = state.project;
    closeModal('project-modal');
    render();
    autoSave();
  }

  function clearAll() {
    if (!confirm('Clear all assignments? (roles and tasks stay)')) return;
    state.tasks.forEach(t => { t.cells = t.cells.map(() => ''); });
    render();
    autoSave();
    toast('All assignments cleared');
  }

  function openModal(id) { document.getElementById(id).classList.add('open'); }
  function closeModal(id) { document.getElementById(id).classList.remove('open'); }

  document.querySelectorAll('.modal-overlay').forEach(m => {
    m.addEventListener('click', e => { if (e.target === m) m.classList.remove('open'); });
  });

  document.getElementById('role-input').addEventListener('keydown', e => {
    if (e.key === 'Enter') confirmAddRole();
  });
  document.getElementById('project-input').addEventListener('keydown', e => {
    if (e.key === 'Enter') confirmNewProject();
  });
  document.getElementById('project-name').addEventListener('change', () => autoSave());

  let toastTimer;
  function toast(msg) {
    const el = document.getElementById('toast');
    document.getElementById('toast-msg').textContent = msg;
    el.classList.add('show');
    clearTimeout(toastTimer);
    toastTimer = setTimeout(() => el.classList.remove('show'), 2200);
  }

  let autoSaveTimer;
  function autoSave() {
    clearTimeout(autoSaveTimer);
    autoSaveTimer = setTimeout(() => saveData(), 900);
  }

  function escHtml(s) {
    return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
  }

  // Init
  loadState();
  document.getElementById('project-name').value = state.project;
  render();
</script>
</body>
</html>
